<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Intelligence Report - ƒåesk√Ω Trh Pr√°ce 2026</title>
    <meta name="description" content="Tr≈æn√≠ intelligence report pro HR profesion√°ly a zamƒõstnavatele. Platov√© benchmarky, anal√Ωza jobs, seniorn√≠ distribuce.">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; background: #f8f9fa; margin: 0; padding: 40px 20px; color: #111; }
        .container { max-width: 1200px; margin: 0 auto; background: #fff; padding: 60px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); border-radius: 12px; }
        
        h1 { font-size: 3.5rem; font-weight: 800; letter-spacing: -2px; margin-bottom: 0.1em; color: #111; }
        h1 span { color: #0055FF; }
        
        .subtitle { color: #666; font-size: 1.2rem; margin-bottom: 60px; border-bottom: 3px solid #111; padding-bottom: 20px; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
        .version-badge { background: #0055FF; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        
        .kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 60px; }
        .kpi-card { background: #fff; padding: 25px; border-radius: 8px; border: 1px solid #eee; border-left: 4px solid #0055FF; transition: transform 0.2s; }
        .kpi-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .kpi-card.highlight { border-left-color: #00FF88; background: linear-gradient(135deg, #f0fff4 0%, #fff 100%); }
        
        .kpi-val { font-size: 2.2rem; font-weight: 700; line-height: 1; color: #111; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .kpi-label { font-size: 0.75rem; text-transform: uppercase; color: #666; letter-spacing: 1px; margin-top: 10px; font-weight: 600; }
        
        .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-bottom: 60px; }
        .section-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 25px; border-left: 4px solid #111; padding-left: 15px; display: flex; align-items: center; }
        .section-title span { color: #0055FF; margin-right: 10px; }
        .section-title .badge { background: #0055FF; color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; margin-left: 10px; }
        
        .hr-section { background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%); padding: 40px; border-radius: 12px; margin: 40px 0; border: 1px solid #e0e5ff; }
        .hr-section h2 { font-size: 1.8rem; margin-bottom: 30px; color: #0055FF; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        thead tr { text-align: left; border-bottom: 2px solid #111; }
        th, td { padding: 12px; }
        tbody tr { border-bottom: 1px solid #eee; }
        tbody tr:hover { background: #f8f9fa; }
        
        .premium-positive { color: #00AA55; font-weight: bold; }
        .premium-negative { color: #DD3333; font-weight: bold; }
        
        .footer { margin-top: 80px; font-size: 0.9rem; color: #888; text-align: center; border-top: 1px solid #eee; padding-top: 30px; }
        
        @media(max-width: 1024px) { .kpi-grid { grid-template-columns: repeat(3, 1fr); } }
        @media(max-width: 768px) { .kpi-grid, .chart-grid { grid-template-columns: 1fr; } .container { padding: 20px; } .kpi-val { font-size: 1.8rem; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ƒåesk√Ω Trh Pr√°ce <span>Intelligence</span></h1>
        <div class="subtitle">
            <span>Tr≈æn√≠ Snapshot - {{ "{:,}".format(total_jobs) }} Aktivn√≠ch Inzer√°t≈Ø</span>
            <span><span class="version-badge">v1.3</span> {{ date }}</span>
        </div>

        <!-- Data Quality Badge -->
        <div style="background: #e8f5e9; padding: 12px 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #4caf50;">
            <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px; font-size: 0.85rem;">
                <div><strong>Velikost vzorku:</strong> {{ "{:,}".format(total_jobs) }} jobs (V√Ωborn√©)</div>
                <div><strong>Pokryt√≠ plat≈Ø:</strong> 44% (Dobr√©)</div>
                <div><strong>Aktu√°lnost dat:</strong> Posledn√≠ch 24 hodin</div>
                <div><strong>Zdroje:</strong> 6 platforem</div>
            </div>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-val">{{ total_jobs }}</div>
                <div class="kpi-label">Aktivn√≠ Pozice</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-val">{{ med_salary }}k</div>
                <div class="kpi-label">Medi√°n Platu (Kƒç)</div>
            </div>
            <div class="kpi-card highlight">
                <div class="kpi-val">{{ tech_premium }}</div>
                <div class="kpi-label">Modern Tech Premium</div>
            </div>
            <div class="kpi-card highlight">
                <div class="kpi-val">{{ seniority_premium }}</div>
                <div class="kpi-label">Senior vs Junior</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-val">{{ en_share }}%</div>
                <div class="kpi-label">Anglicky P≈ô√°telsk√©</div>
            </div>
        </div>

        <!-- v1.0 HR INTELLIGENCE SECTION -->
        <div class="hr-section">
            <h2>üìä HR Intelligence Dashboard</h2>
            
            <div class="chart-grid">
                <div>
                    <div class="section-title"><span>A</span> Plat podle Pozice <span class="badge">NOV√â</span></div>
                    <div id="chart_role"></div>
                </div>
                <div>
                    <div class="section-title"><span>B</span> Plat podle Seniority <span class="badge">NOV√â</span></div>
                    <div id="chart_seniority"></div>
                </div>
            </div>

            {% if skill_premiums %}
            <div style="margin-top: 40px;">
                <div class="section-title"><span>C</span> ≈Ωeb≈ô√≠ƒçek Skill Pr√©mi√≠ <span class="badge">NOV√â</span></div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Skill</th>
                                <th>Medi√°n Platu</th>
                                <th>Premium</th>
                                <th>Poƒçet Pozic</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for skill in skill_premiums %}
                            <tr>
                                <td style="font-weight: 600;">{{ skill.Skill }}</td>
                                <td>{{ skill.Median | int }} Kƒç</td>
                                <td class="{% if '+' in skill.Premium %}premium-positive{% else %}premium-negative{% endif %}">{{ skill.Premium }}</td>
                                <td>{{ skill.Jobs }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            {% if seniority_role_matrix %}
            <div style="margin-top: 40px; background: #fff8e1; padding: 20px; border-radius: 8px; border-left: 4px solid #FFA726;">
                <div class="section-title" style="border-left-color: #FFA726; cursor: pointer; user-select: none;" onclick="toggleSection('dataQualitySection')">
                    <span>‚ö†Ô∏è Kvalita Dat: Plat podle Seniority + Pozice</span>
                    <span id="dataQualityToggle" style="margin-left: auto; font-size: 1.2rem; transition: transform 0.3s;">‚ñº</span>
                </div>
                <div id="dataQualitySection" style="display: none;">
                    <p style="color: #666; margin-bottom: 20px; font-size: 0.9rem;">
                        <strong>Proƒç "Junior" nƒõkdy vydƒõl√°v√° v√≠ce ne≈æ "Mid"?</strong> Tato k≈ô√≠≈æov√° anal√Ωza odhaluje potenci√°ln√≠ inflaci titul≈Ø, klasifikaƒçn√≠ probl√©my nebo bias ve slo≈æen√≠ rol√≠ v datasetu.
                    </p>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Pozice</th>
                                    <th>Seniorita</th>
                                    <th>Medi√°n Platu</th>
                                    <th>Velikost Vzorku</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in seniority_role_matrix %}
                                <tr>
                                    <td style="font-weight: 600;">{{ item.role_type }}</td>
                                    <td style="{% if item.seniority_level == 'Junior' %}color: #FF9800; font-weight: bold;{% elif item.seniority_level == 'Senior' %}color: #0055FF; font-weight: bold;{% endif %}">
                                        {{ item.seniority_level }}
                                    </td>
                                    <td style="font-weight: bold;">{{ item.median_salary | int }} Kƒç</td>
                                    <td style="color: #999;">{{ item.count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- v1.1 MARKET INSIGHTS SECTIONS -->

        <!-- Benefits Intelligence -->
        {% if benefits_data %}
        <div class="hr-section" style="margin-top: 60px;">
            <h2>üéÅ Benefity & V√Ωhody Intelligence</h2>

            <div style="margin-bottom: 40px;">
                <div class="section-title">Nejƒçastƒõji Nab√≠zen√© Benefity</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px;">
                    {% for benefit in benefits_data[:9] %}
                    <div style="background: #f8f9fa; padding: 15px 20px; border-radius: 8px; text-align: center; border: 1px solid #e0e5ff;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #0055FF;">{{ benefit.Percentage }}</div>
                        <div style="font-size: 0.85rem; color: #666; margin-top: 5px; line-height: 1.3;">{{ benefit.Benefit | translate_cz('benefits') }}</div>
                        <div style="font-size: 0.75rem; color: #999; margin-top: 3px;">{{ benefit.Jobs }} pozic</div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {% if benefits_by_role %}
            <div>
                <div class="section-title">Pr≈Ømƒõrn√© Benefity podle Pozice</div>
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Pozice</th>
                                <th>Pr≈Ømƒõrn√Ω Poƒçet Benefit≈Ø</th>
                                <th>Velikost Vzorku</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for role in benefits_by_role %}
                            <tr>
                                <td style="font-weight: 600;">{{ role.role_type | translate_cz('roles') }}</td>
                                <td style="color: #0055FF; font-weight: bold;">{{ "%.1f"|format(role.avg_benefits) }}</td>
                                <td>{{ role.count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Pracovn√≠ Modely Intelligence -->
        {% if work_model_dist %}
        <div class="hr-section" style="margin-top: 40px;">
            <h2>üè† Pracovn√≠ Modely Intelligence</h2>

            <div class="kpi-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 40px;">
                {% for model, count in work_model_dist.items() %}
                <div class="kpi-card {% if 'Remote' in model %}highlight{% endif %}">
                    <div class="kpi-val">{{ count }}</div>
                    <div class="kpi-label">{{ model | translate_cz('work_models') }}</div>
                </div>
                {% endfor %}
            </div>

            {% if remote_premium and remote_premium.premium != 'N/A' %}
            <div style="background: linear-gradient(135deg, #f0fff4 0%, #fff 100%); padding: 20px; border-radius: 8px; border: 1px solid #00FF88; margin-bottom: 40px;">
                <div style="font-size: 1.1rem; font-weight: 600; color: #111; margin-bottom: 10px;">üí∞ Platov√Ω bonus za Remote pr√°ci</div>
                <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                    <div>
                        <span style="color: #666;">Remote pozice:</span>
                        <span style="font-weight: 700; color: #0055FF; margin-left: 8px;">{{ remote_premium.remote_median | int | format(",") }} Kƒç</span>
                    </div>
                    <div>
                        <span style="color: #666;">Kancel√°≈ôsk√© pozice:</span>
                        <span style="font-weight: 700; margin-left: 8px;">{{ remote_premium.office_median | int | format(",") }} Kƒç</span>
                    </div>
                    <div>
                        <span style="color: #666;">Pr√©mie:</span>
                        <span style="font-weight: 700; color: #00AA55; font-size: 1.2rem; margin-left: 8px;">{{ remote_premium.premium }}</span>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if work_model_by_role %}
            <div>
                <div class="section-title">Pracovn√≠ Model podle Pozice (%)</div>
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Pozice</th>
                                {% if 'Hybrid' in work_model_by_role[0] %}<th>Hybrid %</th>{% endif %}
                                {% if 'Office' in work_model_by_role[0] %}<th>Kancel√°≈ô %</th>{% endif %}
                                {% if 'Remote' in work_model_by_role[0] %}<th>Remote %</th>{% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for role in work_model_by_role %}
                            <tr>
                                <td style="font-weight: 600;">{{ role.role_type | translate_cz('roles') }}</td>
                                {% if 'Hybrid' in role %}<td>{{ "%.1f"|format(role.Hybrid) }}%</td>{% endif %}
                                {% if 'Office' in role %}<td>{{ "%.1f"|format(role.Office) }}%</td>{% endif %}
                                {% if 'Remote' in role %}<td style="color: #0055FF; font-weight: bold;">{{ "%.1f"|format(role.Remote) }}%</td>{% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Location Intelligence - HIDDEN: Most data is generic "CZ", not specific cities -->
        <!-- Will activate when scraper provides city-specific data (Prague, Brno, Ostrava, etc.) -->

        <!-- v1.2 Emerging Market Signals -->
        {% if emerging_tech or new_entrants or trending_benefits %}
        <div class="hr-section" style="margin-top: 40px;">
            <h2>üìà Tr≈æn√≠ Signals & Vznikaj√≠c√≠ Trendy</h2>

            {% if not data_freshness.trend_analysis_ready %}
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #2196F3;">
                <p style="margin: 0; color: #1565C0; font-size: 0.9rem;">
                    <strong>üìä Trend Analysis Status:</strong> Currently analyzing <strong>{{ data_freshness.unique_dates }}</strong> day(s) of data.
                    Weekly salary trends will activate automatically after collecting 7+ days of data.
                </p>
            </div>
            {% endif %}

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                {% if emerging_tech %}
                <div>
                    <div class="section-title">üî• ≈Ωhav√© Technologie</div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Technologie</th>
                                    <th>Market Share</th>
                                    <th>Pozice</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tech in emerging_tech[:8] %}
                                <tr>
                                    <td style="font-weight: 600;">{{ tech.Technology }}</td>
                                    <td style="color: #0055FF; font-weight: bold;">{{ tech['Market Share'] }}</td>
                                    <td>{{ tech.Jobs }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}

                {% if new_entrants %}
                <div>
                    <div class="section-title">üöÄ Aktivnƒõ Naj√≠maj√≠c√≠ Firmy</div>
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">Firmy s 5-15 aktivn√≠mi inzer√°ty (r≈Østov√° f√°ze)</p>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Firma</th>
                                    <th>Active Jobs</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for company in new_entrants[:8] %}
                                <tr>
                                    <td style="font-weight: 600;">{{ company.Company }}</td>
                                    <td style="color: #FF9800; font-weight: bold;">{{ company['Active Jobs'] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- REMOVED: Duplicate of Benefits Intelligence section above -->
        </div>
        {% endif %}

        <!-- v1.3 Ekonomick√° Realita & Dynamika Talent≈Ø -->
        <div class="hr-section" style="margin-top: 40px;">
            <h2>üí∞ Ekonomick√° Realita & Dynamika Talent≈Ø</h2>
            <p style="color: #666; margin-bottom: 30px; font-size: 0.95rem;">
                Hloubkov√° tr≈æn√≠ intelligence odhaluj√≠c√≠ platov√© arbitr√°≈æe, zdrav√≠ talent pipeline a skuteƒçnou vs "fale≈°nou" flexibilitu.
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- IƒåO vs HPP Arbitr√°≈æ -->
                {% if ico_arbitrage.available %}
                <div style="background: linear-gradient(135deg, #fff3e0 0%, #fff 100%); padding: 20px; border-radius: 8px; border: 1px solid #ffb74d;">
                    <div style="font-size: 0.9rem; font-weight: 600; color: #e65100; margin-bottom: 10px;">üìã IƒåO vs HPP Arbitr√°≈æ</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #f57c00;">{{ ico_arbitrage.premium }}</div>
                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                        IƒåO: {{ ico_arbitrage.ico_median | int }} Kƒç<br>
                        HPP: {{ ico_arbitrage.hpp_median | int }} Kƒç
                    </div>
                    <div style="font-size: 0.75rem; color: #999; margin-top: 8px;">Vzorek: IƒåO ({{ico_arbitrage.ico_count}}), HPP ({{ico_arbitrage.hpp_count}})</div>
                </div>
                {% endif %}

                <!-- Language Barrier Cost - HIDDEN: Sample size too small (n=53) -->
                {% if lang_barrier.available and lang_barrier.english_count >= 100 %}
                <div style="background: linear-gradient(135deg, #e8eaf6 0%, #fff 100%); padding: 20px; border-radius: 8px; border: 1px solid #7986cb;">
                    <div style="font-size: 0.9rem; font-weight: 600; color: #303f9f; margin-bottom: 10px;">üåç Language Barrier Cost</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #3f51b5;">{{ lang_barrier.premium }}</div>
                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                        Angliƒçtina: {{ lang_barrier.english_median | int }} Kƒç<br>
                        Pouze ƒçe≈°tina: {{ lang_barrier.czech_median | int }} Kƒç
                    </div>
                    <div style="font-size: 0.75rem; color: #999; margin-top: 8px;">Sample: EN ({{lang_barrier.english_count}}), CZ ({{lang_barrier.czech_count}})</div>
                </div>
                {% endif %}

                <!-- Zdrav√≠ Talent Pipeline -->
                {% if pipeline_health.available %}
                <div style="background: linear-gradient(135deg, {% if pipeline_health.health_color == 'green' %}#e8f5e9{% elif pipeline_health.health_color == 'orange' %}#fff3e0{% else %}#ffebee{% endif %} 0%, #fff 100%); padding: 20px; border-radius: 8px; border: 1px solid {% if pipeline_health.health_color == 'green' %}#81c784{% elif pipeline_health.health_color == 'orange' %}#ffb74d{% else %}#e57373{% endif %};">
                    <div style="font-size: 0.9rem; font-weight: 600; color: {% if pipeline_health.health_color == 'green' %}#2e7d32{% elif pipeline_health.health_color == 'orange' %}#e65100{% else %}#c62828{% endif %}; margin-bottom: 10px;">üéØ Junior:Senior Ratio</div>
                    <div style="font-size: 2rem; font-weight: 700; color: {% if pipeline_health.health_color == 'green' %}#4caf50{% elif pipeline_health.health_color == 'orange' %}#ff9800{% else %}#f44336{% endif %};">{{ pipeline_health.ratio }}</div>
                    <div style="font-size: 1rem; font-weight: 600; margin-top: 5px;">{{ pipeline_health.health }}</div>
                    <div style="font-size: 0.75rem; color: #666; margin-top: 8px;">Jr:{{pipeline_health.junior}} | Mid:{{pipeline_health.mid}} | Sr:{{pipeline_health.senior}}</div>
                </div>
                {% endif %}

                <!-- AI Washing -->
                {% if ai_washing.available %}
                <div style="background: linear-gradient(135deg, #f3e5f5 0%, #fff 100%); padding: 20px; border-radius: 8px; border: 1px solid #ba68c8;">
                    <div style="font-size: 0.9rem; font-weight: 600; color: #6a1b9a; margin-bottom: 10px;">ü§ñ AI Washing (Non-Tech)</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #9c27b0;">{{ ai_washing.percentage }}</div>
                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                        {{ ai_washing.ai_mentions }} / {{ ai_washing.total_nontech }} jobs
                    </div>
                    <div style="font-size: 0.75rem; color: #999; margin-top: 8px;">HR, Sales, Marketing, etc.</div>
                </div>
                {% endif %}
            </div>

            <!-- Remote Flexibility Analysis -->
            {% if remote_flex %}
            <div style="margin-top: 30px;">
                <div class="section-title">üè† Realita Remote/Hybrid Flexibility</div>
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">Znamen√° "Hybrid" flexibiln√≠ svobodu nebo rigidn√≠ pevn√© dny?</p>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    {% for flex in remote_flex %}
                    <div style="background: #f8f9fa; padding: 15px 25px; border-radius: 8px; text-align: center; min-width: 160px; border: 1px solid {% if 'Flexible' in flex.Flexibility %}#00e676{% elif 'Rigid' in flex.Flexibility %}#ff5252{% else %}#bdbdbd{% endif %};">
                        <div style="font-size: 1.6rem; font-weight: 700; color: {% if 'Flexible' in flex.Flexibility %}#00c853{% elif 'Rigid' in flex.Flexibility %}#d32f2f{% else %}#757575{% endif %};">{{ flex.Percentage }}</div>
                        <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">{{ flex.Flexibility }}</div>
                        <div style="font-size: 0.75rem; color: #999; margin-top: 3px;">{{ flex.Count }} jobs</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Legacy Rot by Pozice -->
            {% if legacy_rot %}
            <div style="margin-top: 30px;">
                <div class="section-title">‚öôÔ∏è Legacy Tech Debt podle Pozice</div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Pozice</th>
                                <th>Legacy %</th>
                                <th>Modern %</th>
                                <th>Total Jobs</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for role in legacy_rot %}
                            <tr>
                                <td style="font-weight: 600;">{{ role.Role }}</td>
                                <td style="color: #d32f2f; font-weight: bold;">{{ role['Legacy %'] }}</td>
                                <td style="color: #00c853; font-weight: bold;">{{ role['Modern %'] }}</td>
                                <td>{{ role['Total Jobs'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <!-- Ghost Pozice -->
            {% if ghost_jobs %}
            <div style="margin-top: 30px; background: #fff8e1; padding: 20px; border-radius: 8px; border-left: 4px solid #FFA726;">
                <div class="section-title" style="border-left-color: #FFA726; cursor: pointer; user-select: none;" onclick="toggleSection('ghostJobsSection')">
                    <span>üëª Potential Ghost Pozice (High Repost Volume)</span>
                    <span id="ghostJobsToggle" style="margin-left: auto; font-size: 1.2rem; transition: transform 0.3s;">‚ñº</span>
                </div>
                <div id="ghostJobsSection" style="display: none;">
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.85rem;">
                        Stejn√Ω n√°zev pozice zve≈ôejnƒõn 3x+ stejnou firmou. M≈Ø≈æe indikovat vysokou fluktuaci, sbƒõr CV nebo trval√© otev≈ôen√© pozice.
                    </p>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Firma</th>
                                    <th>N√°zev</th>
                                    <th>Repost Count</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for job in ghost_jobs[:10] %}
                                <tr>
                                    <td style="font-weight: 600;">{{ job.Company }}</td>
                                    <td>{{ job.Title }}</td>
                                    <td style="color: #ff9800; font-weight: bold;">{{ job['Repost Count'] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- MARKET OVERVIEW SECTION -->
        <div class="chart-grid">
            <div>
                <div class="section-title"><span>01</span> Typy Smluv</div>
                <div id="chart_contract"></div>
            </div>
            <div>
                <div class="section-title"><span>02</span> Tech Stack Gap</div>
                <div id="chart_tech"></div>
            </div>
        </div>

        <div style="margin-top: 60px;">
            <div class="section-title"><span>03</span> Top Inov√°to≈ôi (Objem N√°boru v Modernm Stacku)</div>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Firma</th>
                            <th>Signals</th>
                            <th>Avg. Salary (Est)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for innovator in innovators %}
                        <tr>
                            <td style="font-weight: 600; max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ innovator.company }}">{{ innovator.company }}</td>
                            <td>{{ innovator.count }}</td>
                            <td style="color: #0055FF; font-weight: bold;">{{ innovator.avg_sal }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan='3' style='padding: 20px; text-align: center; color: #888;'>Insufficient data for density analysis.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        {% if top_roles %}
        <div style="margin-top: 40px;">
            <div class="section-title"><span>04</span> Distribuce Pozic (Top 5)</div>
            <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 20px;">
                {% for role in top_roles %}
                <div style="background: #f8f9fa; padding: 15px 25px; border-radius: 8px; text-align: center; min-width: 120px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #0055FF;">{{ role.Count }}</div>
                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">{{ role.Role }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="footer">
            Vygenerov√°no pomoc√≠ <a href="https://github.com/hiddenmany/jobinsight_czechia" style="color:#0055FF; font-weight:bold; text-decoration:none;">JobsCzInsight v1.3</a> - Edice Ekonomick√° Realita
        </div>
    </div>
    
    <script>
        var contract_data = {{ json_contract | safe }};
        Plotly.newPlot('chart_contract', contract_data.data, contract_data.layout);

        var tech_data = {{ json_tech | safe }};
        Plotly.newPlot('chart_tech', tech_data.data, tech_data.layout);

        var role_data = {{ json_role | safe }};
        Plotly.newPlot('chart_role', role_data.data, role_data.layout);

        var seniority_data = {{ json_seniority | safe }};
        Plotly.newPlot('chart_seniority', seniority_data.data, seniority_data.layout);

        // Toggle function for collapsible sections
        function toggleSection(sectionId) {
            var section = document.getElementById(sectionId);
            var toggle = document.getElementById(sectionId.replace('Section', 'Toggle'));

            if (section.style.display === 'none') {
                section.style.display = 'block';
                toggle.textContent = '‚ñ≤';
            } else {
                section.style.display = 'none';
                toggle.textContent = '‚ñº';
            }
        }
    </script>
</body>
</html>
